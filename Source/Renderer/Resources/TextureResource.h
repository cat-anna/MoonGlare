/*
  * Generated by cppsrc.sh
  * On 2017-02-13 22:45:35,93
  * by Kalessin
*/
/*--END OF HEADER BLOCK--*/

#pragma once

#include "../nfRenderer.h"
#include "../Configuration.Renderer.h"

namespace MoonGlare::Renderer::Resources {

class alignas(16) TextureResource {
	using ThisClass = TextureResource;
	using Conf = Configuration::Resources;

	static constexpr TextureResourceHandle::Index_t GuardValue = 0xFADE;
public:
	bool Initialize(ResourceManager* Owner);
	bool Finalize();

	bool Allocate(Commands::CommandQueue &queue, TextureResourceHandle &out);

	bool Allocate(Frame *frame, TextureResourceHandle &out);
	void Release(Frame *frame, TextureResourceHandle h);

	TextureHandle* GetHandleArrayBase() { return &m_GLHandle[0]; }
private: 
	template<typename T>
	using Array = std::array<T, Conf::TextureLimit>;
	using Bitmap = Conf::BitmapAllocator<Conf::TextureLimit>;

	Bitmap m_AllocationBitmap;
	Array<TextureHandle> m_GLHandle;
	ResourceManager *m_ResourceManager = nullptr;
	void* padding;

	DeclarePerformanceCounter(SuccessfulAllocations);
	DeclarePerformanceCounter(SuccessfulDellocations);
	DeclarePerformanceCounter(FailedAllocations);
	DeclarePerformanceCounter(FailedDellocations);
	DeclarePerformanceCounter(OpenGLAllocations);
	DeclarePerformanceCounter(OpenGLDeallocations);
};

static_assert((sizeof(TextureResource) % 16) == 0, "Invalid size!");
//static_assert(std::is_trivial<TextureResource>::value, "Invalid size!");//atomics

} //namespace MoonGlare::Renderer::Resources 
