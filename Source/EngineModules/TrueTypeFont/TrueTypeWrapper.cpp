/*
  * Generated by cppsrc.sh
  * On 2015-05-29 20:31:23,16
  * by Paweu
*/
/*--END OF HEADER BLOCK--*/
#include <pch.h>
#include <MoonGlare.h>
#include <Engine/Renderer/nRenderer.h>
#include <Engine/DataClasses/iFont.h>
#include "FreeTypeHelper.h"
#include "TrueTypeWrapper.h"

namespace MoonGlare {
namespace Modules {
namespace TrueTypeFont {

GABI_IMPLEMENT_STATIC_CLASS(TrueTypeWrapper);

TrueTypeWrapper::TrueTypeWrapper():
		BaseClass(),
		m_VAO() {
	m_Texture = Renderer::GetRenderer()->Resources().GetTextures().Allocate();
}

TrueTypeWrapper::~TrueTypeWrapper() {
	Renderer::GetRenderer()->Resources().GetTextures().Release(m_Texture);
}

//----------------------------------------------------------------
 
void TrueTypeWrapper::Render(Graphic::cRenderDevice &dev) {
	if (m_Chars.empty())
		return;

	m_VAO.Bind();
	uint32_t id = 0;
	dev.CurrentShader()->SetBackColor(m_Color);
	for (auto it : m_Chars) {
		if (!it->m_Ready)
			break;
		it->m_Texture.Bind();
		m_VAO.DrawElements(4, id * 4, 0, Graphic::Flags::fQuads);
		++id;
	}
	m_VAO.UnBind();
}

void TrueTypeWrapper::RenderMesh(Graphic::cRenderDevice &dev) {
	//m_VAO.RenderMesh(m_Meshes);
}

} //namespace TrueTypeFont 
} //namespace Modules 
} //namespace MoonGlare 
