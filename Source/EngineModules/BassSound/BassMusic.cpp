/*
	Generated by cppsrc.sh
	On 2015-01-24 10:42:35,52
	by Paweu
*/
#include <pch.h>
#include <MoonGlare.h>
#include <Engine/iSoundEngine.h>
#include "iBassChannel.h"
#include "BassInternal.h"
#include "BassMusic.h"

namespace MoonGlare {
namespace Modules {
namespace BassSound {

GABI_IMPLEMENT_CLASS(BassMusic);

BassMusic::BassMusic(DataModule *Owner):
		BaseClass() {
}

BassMusic::~BassMusic() {
}

bool BassMusic::Initialize() {
	StarVFS::ByteTable data;

	if (!GetFileSystem()->OpenFile(GetFileName(), DataPath::Root, data)) {
		AddLogf(Error, "Unable to load music '%s'", GetName().c_str());
		return false;
	}
	m_Handle = BASS_MusicLoad(true, data.get(), 0, data.size(), BASS_MUSIC_PRESCAN, 0);
	if (!m_Handle) {
		DecodeErrorCode(__FUNCTION__);
		return false;
	}
	return BaseClass::Initialize();
}

bool BassMusic::Finalize() {
	if (!IsReady()) return true;
	BaseClass::Finalize();
	if (m_Handle) {
		if (!BASS_MusicFree(m_Handle))
			DecodeErrorCode(__FUNCTION__);
		m_Handle = 0;
	}
	return true;
}

} //namespace BassSound 
} //namespace Modules 
} //namespace MoonGlare 
