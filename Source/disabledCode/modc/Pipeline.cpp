/*
	Generated by cppsrc.sh
	On 2015-01-03 19:14:38,93
	by Paweu
*/

#include <pch.h>
#include <MoonGlare.h>
#include <libs/InternalFileSystem/FolderContainer.h>
#include "work.h"
#include "Pipeline.h"

namespace modc {
namespace pipeline {	

void Pipeline::Execute(WorkConfiguration &data) {
	data.pipeline = this;

	while (!m_StageQueue.empty()) {
		auto stage = m_StageQueue.front();
		m_StageQueue.pop();

		data.StageActionIndex = 0;
		if (Verbosity::PrintCurrentStage())
			cout << data.StageCounter() << "Entering stage " << stage.Name << "\n";

		stage.StartFunc(*this);

		while (!m_pipeline.empty()) {
			auto f = m_pipeline.top();
			m_pipeline.pop();
			try {
				++data.StageActionIndex;
				f.func(data);
			} 
			catch(const char* mesg) {
				throw std::runtime_error(mesg);
			}
		}
		++data.StageIndex;
	}
}

//-----------------------------------------------------------------------------

}// namespace pipeline
}// namespace modc
