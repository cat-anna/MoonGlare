/*
	Generated by cppsrc.sh
	On 2015-01-12 15:56:50,19
	by Paweu
*/
#include <pch.h>
#include "Graphic.h"

namespace Graphic {

SPACERTTI_IMPLEMENT_CLASS_NOCREATOR(Environment);

Environment::Environment(): 
		BaseClass(),
		m_StaticFog() {
}
 
Environment::~Environment() {
}

bool Environment::Initialize() {
	m_SkyCube.Initialize();
	return true;
}

bool Environment::Finalize() {
	m_SkyCube.Finalize();
	return true;
}

bool Environment::LoadMeta(const xml_node node, FileSystem::DirectoryReader &reader) {
	if (!node) return true;
	if (!m_StaticFog.LoadMeta(node.child("StaticFog"))) {
		AddLog(Warning, "An error has occur during loading static fog configuration");
	}
	if (!m_AmbientLight.LoadMeta(node.child("AmbientLight"))) {
		AddLog(Warning, "An error has occur during loading ambient light configuration");
	}
	m_AmbientLight.DiffuseIntensity = 0.0f;//no diffuse for environment ambient light

	xml_node cube = node.child("SkyCube");
	if (!cube) m_HaveSkyCube = false;
	else {
		if (!m_SkyCube.LoadMeta(cube, reader)) {
			AddLog(Warning, "An error has occur during loading sky cube");
			m_HaveSkyCube = false;
		} else
		m_HaveSkyCube = true;
	}
	return true;
}

} //namespace Graphic 
