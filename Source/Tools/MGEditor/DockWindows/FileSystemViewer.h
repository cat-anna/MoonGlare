/*
  * Generated by cppsrc.sh
  * On 2016-07-22  0:08:40,44
  * by Paweu
*/
/*--END OF HEADER BLOCK--*/

#pragma once
#ifndef FileSystemViewer_H
#define FileSystemViewer_H

#include <DockWindow.h>
#include "../Notifications.h"
#include "../FileSystem.h"
#include <iEditor.h>

namespace Ui { class FilesystemViewer; }

namespace MoonGlare {
namespace Editor {
namespace DockWindows {

struct FileSystemViewerRole {
	enum {
		FileURI = Qt::UserRole + 1,
		FileHash,
		FileFullName,
		IsFile,
		SortString,
	};
};

class FileSystemViewer 
	: public QtShared::DockWindow
	, public QtShared::iEditor {
	Q_OBJECT;
public:
 	FileSystemViewer(QWidget *parent = nullptr);
 	virtual ~FileSystemViewer();

	virtual bool DoSaveSettings(pugi::xml_node node) const override;
	virtual bool DoLoadSettings(const pugi::xml_node node) override;

	virtual bool Create(const std::string &LocationURI, const QtShared::FileCreationMethodInfo& what);
protected:
	void Clear();
	void RefreshTreeView();
protected slots:
	void ShowContextMenu(const QPoint &);
	void ItemDoubleClicked(const QModelIndex&);
	void RefreshFilesystem();
	void ProjectChanged(Module::SharedDataModule datamod);
	void OpenItem();
private: 
	std::unique_ptr<Ui::FilesystemViewer> m_Ui;
	std::unique_ptr<QStandardItemModel> m_ViewModel;
	std::unordered_map<StarVFS::FileID, QStandardItem *> m_VFSItemMap;
	std::unordered_map<std::string, QString> m_ExtIconMap;
	Module::SharedDataModule m_Module;
	SharedFileSystem m_FileSystem;
};

} //namespace DockWindows 
} //namespace Editor 
} //namespace MoonGlare 

#endif
