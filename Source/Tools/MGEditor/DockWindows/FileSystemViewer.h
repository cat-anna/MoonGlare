/*
  * Generated by cppsrc.sh
  * On 2016-07-22  0:08:40,44
  * by Paweu
*/
/*--END OF HEADER BLOCK--*/

#pragma once
#ifndef FileSystemViewer_H
#define FileSystemViewer_H

#include <DockWindow.h>
#include "../Notifications.h"
#include "../FileSystem.h"
#include <iEditor.h>

#include <Module.h>
#include <iFileIconProvider.h>

#include "iFileSystemViewerPreview.h"

namespace Ui { class FilesystemViewer; }

namespace MoonGlare {
namespace Editor {
namespace DockWindows {

struct FileSystemViewerRole {
	enum {
		FileURI = Qt::UserRole + 1,
		FileHash,
		FileFullName,
		IsFile,
		SortString,
	};
};

class FileSystemViewer 
	: public QtShared::DockWindow
	, public QtShared::iEditor
    , public iFileSystemViewerPreview {
	Q_OBJECT;
public:
 	FileSystemViewer(QWidget *parent, QtShared::WeakModule module);
 	virtual ~FileSystemViewer();

	bool DoSaveSettings(pugi::xml_node node) const override;
	bool DoLoadSettings(const pugi::xml_node node) override;

	bool Create(const std::string &LocationURI, const QtShared::iEditorInfo::FileHandleMethodInfo& what) override;

    void SetPreviewEditor(QtShared::SharedEditor editor) override;
protected:
	void Clear();
protected slots:
	void ShowContextMenu(const QPoint &);
	void ItemDoubleClicked(const QModelIndex&);
	void RefreshFilesystem();
	void RefreshTreeView();
	void ProjectChanged(Module::SharedDataModule datamod);
	void OpenItem();
private: 
	std::unique_ptr<Ui::FilesystemViewer> m_Ui;
	std::unique_ptr<QStandardItemModel> m_ViewModel;
	std::unordered_map<StarVFS::FileID, QStandardItem *> m_VFSItemMap;
	Module::SharedDataModule m_Module;
	SharedFileSystem m_FileSystem;
	QtShared::WeakModule m_EditorModule;
    QtShared::SharedEditor currentPreviewEditor;

	std::shared_ptr<QtShared::FileIconProvider> m_FileIconProvider;
	std::weak_ptr<QtShared::EditorProvider> m_EditorProvider;//TODO: workaround
};

} //namespace DockWindows 
} //namespace Editor 
} //namespace MoonGlare 

#endif
