/*
  * Generated by cppsrc.sh
  * On 2016-07-22  0:08:40,44
  * by Paweu
*/
/*--END OF HEADER BLOCK--*/

#pragma once
#ifndef SceneEditor_H
#define SceneEditor_H

#include <DockWindow.h>
#include "../Notifications.h"
#include "../FileSystem.h"
#include <ChangesManager.h>

#include <DataModels/StructureEditingModel.h>
#include <DataModels/EntityEditorModel.h>
#include <TypeEditor/ComponentInfo.h>

namespace Ui { class SceneEditor; }

namespace MoonGlare {
namespace Editor {
namespace DockWindows {

struct SystemInstance {
	TypeEditor::SharedSystemInfo m_SystemInfo;
	TypeEditor::UniqueStructure m_Config;

	bool m_Enabled = true;
 
	bool operator == (const TypeEditor::SharedSystemInfo &sci) const {
		return m_SystemInfo == sci;
	}
};
using SharedSystemInstance = std::shared_ptr<SystemInstance>;

struct SceneEditorRole {
	enum {
		SystemInstance = Qt::UserRole,
	};
};

class SceneEditor
	: public QtShared::DockWindow
	, public QtShared::iChangeContainer
	, public QtShared::iEditor {
	Q_OBJECT;
public:
	SceneEditor(QWidget *parent, SharedModuleManager modmgr);
 	virtual ~SceneEditor();

	class SceneEntity : public QtShared::DataModels::EditableEntity {
	};

	virtual bool DoSaveSettings(pugi::xml_node node) const override;
	virtual bool DoLoadSettings(const pugi::xml_node node) override;

	void Clear();
// iEditor
	virtual bool Create(const std::string &LocationURI, const  QtShared::iEditorInfo::FileHandleMethodInfo& what) override;
	virtual bool OpenData(const std::string &URI);
	virtual bool SaveData();
	virtual bool TryCloseData();
//iChangeContainer
	virtual bool SaveChanges() override { return SaveData(); }
	virtual std::string GetInfoLine() const override { return m_SceneURI; }
protected:
protected slots:
	void Refresh();
	void RefreshSystemTree();
	void ResetSystemList();
	bool WriteSystemTree(pugi::xml_node node) const;
	bool ReadSystemTree(const pugi::xml_node node);
	void ComponentChanged(QStandardItem *item);
private:
	std::unique_ptr<Ui::SceneEditor> m_Ui;
	std::unique_ptr<QStandardItemModel> m_ComponentModel;
	std::vector<SharedSystemInstance> m_SystemInstances;
	SceneEntity *m_SceneEntity;
	std::string m_SceneURI;
    SharedModuleManager moduleManager;
};

} //namespace DockWindows 
} //namespace Editor 
} //namespace MoonGlare 

Q_DECLARE_METATYPE(MoonGlare::Editor::DockWindows::SystemInstance*)

#endif
                                                            